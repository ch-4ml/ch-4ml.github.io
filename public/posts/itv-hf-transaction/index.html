<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>itv-hf-transaction | ch-4ml</title><meta name="description" content="itv-hf-transaction"><meta name="keywords" content=""><meta name="author" content="ch-4ml"><meta name="copyright" content="ch-4ml"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><script src="/js/third-party/bootstrap.min.js"></script><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="canonical" href="https://ch-4ml.github.io/posts/itv-hf-transaction/"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="next" title="알고리즘 문제 해결 스터디" href="https://ch-4ml.github.io/posts/algorithm-study/"><link rel="dns-prefetch" href="https://www.google-analytics.com"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-151506248-1', 'auto');
ga('send', 'pageview');
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight_copy: 'false',
  highlight_lang: 'true',
  highlight_shrink: 'false',
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  bookmark: {
    title: 'Bookmark',
    message_prev: 'Press',
    message_next: 'to bookmark this page'
  },
  runtime_unit: 'days',
  copyright: undefined,
  copy_copyright_js: false
  
}</script></head><body><div id="header"> <div id="page-header"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">ch-4ml</a></span><i class="fa fa-bars fa-fw toggle-menu pull-right close" aria-hidden="true"></i><span class="pull-right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/portfolio"><i class="fa-fw fa fa-folder-open"></i><span> Portfolio</span></a></div><div class="menus_item"><a class="site-page" href="/categories/Study"><i class="fa-fw fa fa-book"></i><span> Study</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div><script>document.body.addEventListener('touchstart', function(){ });</script></div></span><span class="pull-right" id="search_button"></span></div></div><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="lozad avatar_img" src="/img/portrait_rect.jpg" onerror="onerror=null;src='/img/friend_404.gif'"></div><div class="mobile_post_data"><div class="mobile_data_item is_center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">Articles</div><div class="length_num">13</div></a></div></div><div class="mobile_data_item is_center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">Tags</div><div class="length_num">20</div></a></div></div><div class="mobile_data_item is_center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">Categories</div><div class="length_num">8</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/portfolio"><i class="fa-fw fa fa-folder-open"></i><span> Portfolio</span></a></div><div class="menus_item"><a class="site-page" href="/categories/Study"><i class="fa-fw fa fa-book"></i><span> Study</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div><script>document.body.addEventListener('touchstart', function(){ });</script></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">Catalog</div><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#MVCC-충돌과-낙관적-잠금"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">MVCC 충돌과 낙관적 잠금</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#MVCC란"><span class="toc_mobile_items-number">1.1.</span> <span class="toc_mobile_items-text">MVCC란?</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#Transaction-Lifecycle-in-Hyperledger-Fabric"><span class="toc_mobile_items-number">1.2.</span> <span class="toc_mobile_items-text">Transaction Lifecycle in Hyperledger Fabric</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#자-여기서-문제가-무엇일까요"><span class="toc_mobile_items-number">1.2.1.</span> <span class="toc_mobile_items-text">자, 여기서 문제가 무엇일까요?</span></a></li></ol></li></ol></li></ol></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#MVCC-충돌과-낙관적-잠금"><span class="toc-number">1.</span> <span class="toc-text">MVCC 충돌과 낙관적 잠금</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#MVCC란"><span class="toc-number">1.1.</span> <span class="toc-text">MVCC란?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Transaction-Lifecycle-in-Hyperledger-Fabric"><span class="toc-number">1.2.</span> <span class="toc-text">Transaction Lifecycle in Hyperledger Fabric</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#자-여기서-문제가-무엇일까요"><span class="toc-number">1.2.1.</span> <span class="toc-text">자, 여기서 문제가 무엇일까요?</span></a></li></ol></li></ol></li></ol></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png)"><div id="post-info"><div id="post-title"><div class="posttitle">itv-hf-transaction</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> Created 2019-11-15<span class="post-meta__separator">|</span><i class="fa fa-history" aria-hidden="true"></i> Updated 2019-11-17</time><div class="post-meta-wordcount"><span>Post View: </span><span id="busuanzi_value_page_pv"></span></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><h1 id="MVCC-충돌과-낙관적-잠금"><a href="#MVCC-충돌과-낙관적-잠금" class="headerlink" title="MVCC 충돌과 낙관적 잠금"></a>MVCC 충돌과 낙관적 잠금</h1><p>MVCC conflict &amp; Optimistic lock</p>
<h2 id="MVCC란"><a href="#MVCC란" class="headerlink" title="MVCC란?"></a>MVCC란?</h2><p>MVCC(Multi-Version Concurrency Control)는 동시 접근을 허용하는 저장소에서 동시성을 제어하기 위해(간단히 말해서 키 충돌을 막기 위해) 사용하는 방법중 하나로, MCC라고도 합니다.</p>
<p>이 때, 키 충돌은 Hyperledger Fabric에만 국한된 것이 아니라 전반적인 컴퓨터 과학 문제입니다.</p>
<p>Hyperledger Fabric에 초점을 맞춰 설명하기 위해서는 먼저 Transaction Lifecycle을 살펴볼 필요가 있습니다.</p>
<h2 id="Transaction-Lifecycle-in-Hyperledger-Fabric"><a href="#Transaction-Lifecycle-in-Hyperledger-Fabric" class="headerlink" title="Transaction Lifecycle in Hyperledger Fabric"></a>Transaction Lifecycle in Hyperledger Fabric</h2><img class="lozad" title="Transaction Life Cycle in Hyperledger Fabric" data-src="/posts/itv-hf-transaction/tx-life-cycle.png">
<ol>
<li>SDK가 하나 이상의 Peer에게 Transaction Proposal을 전송합니다.</li>
<li>Peer는 Chaincode, Ledger의 현재 상태, Request의 Parameter를 이용하여 해당 트랜잭션을 시뮬레이션 합니다.</li>
<li>Peer는 시뮬레이션 결과를 SDK에 Return합니다. 결과는 시뮬레이션 중 업데이트 된 Key/Value Set입니다.</li>
<li>SDK는 3의 Set(여러개의 Set도 가능)를 수집하고 개인 키로 서명한 뒤 Ordering Service(Orderer)에 전송합니다.</li>
<li>Ordering Service는 서명과 Set의 유효성을 검증한 뒤 Queue에 넣습니다.</li>
<li>Queue가 꽉 차거나 사전에 정의된 시간이 지나면, 이 Set들을 정렬하고 블록에 담은 뒤, 블록에 서명하고 Peer에 블록을 전송합니다.</li>
<li>Peer는 서명의 유효성을 검증하고, Ledger의 상태가 시뮬레이션이 실행됐을 때의 상태와 같은지 검증합니다.</li>
<li>유효성 검증이 성공하면 해당 Transaction은 Ledger를 Update합니다.</li>
<li>유효성 검증이 실패하면 해당 Transaction은 Blockchain에 저장되지만, Ledger는 업데이트되지 않습니다.</li>
</ol>
<p>이 설명에서 많은 세부 사항이 누락되었지만 지금은 그렇게 중요하지 않습니다.</p>
<p>SDK가 첫 번째 요청을 보내는 시간과 이 트랜잭션이 실제로 블록체인에 저장되는 시간은 정해져있지 않고, 몇 초 정도 소요됩니다. 그리고 이 과정은 대부분 병렬로 실행됩니다.</p>
<h3 id="자-여기서-문제가-무엇일까요"><a href="#자-여기서-문제가-무엇일까요" class="headerlink" title="자, 여기서 문제가 무엇일까요?"></a>자, 여기서 문제가 무엇일까요?</h3><p>간단한 예시를 봅시다. 밥이 앨리스에게 송금하는 체인코드가 있는데, 체인코드는 송금하기 전에 밥이 충분한 액수를 가지고 있는지 반드시 검증해야 하고, 그렇지 않은 경우에는 취소되어야 합니다.</p>
<p>현재 밥은 10개의 토큰을 가지고 있고 10개의 토큰을 앨리스에게 보내도록 요청했습니다.<br>체인코드는 이 액수가 정확한지를 시뮬레이션 하는 동안에 검증할 것입니다. 그리고 이 트랜잭션은 Commit을 위해 Orderer에게 보내집니다.</p>
<p>하지만, 만약 동시에 밥이 10개의 토큰을 보내기 위해 다른 트랜잭션을 이브한테 전송한다면 어떤 일이 일어날지 상상해보세요. 시뮬레이션에서 앨리스에게 전송했다는 사실은 검증되지만 Commit되지 않았기 때문에, 체인코드는 밥이 필요한 액수를 보유했다고 확인할 것입니다. 결과적으로 밥은 10개의 토큰을 가지고 있는 동안에 20개의 토큰을 전송하게 되는 것입니다.</p>
<p>이것이 바로 전형적인 “이중 지불 문제(Double Spending Problem)”입니다.</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined" target="_blank" rel="noopener">ch-4ml</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://ch-4ml.github.io/posts/itv-hf-transaction/">https://ch-4ml.github.io/posts/itv-hf-transaction/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" data-sites="facebook,twitter"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script></div></div><nav class="pagination_post" id="pagination"><div class="next-post pull-full"><a href="/posts/algorithm-study/"><img class="next_cover lozad" data-src="/posts/algorithm-study/오구.gif" onerror="onerror=null;src='/img/404.jpg'"><div class="label">Next Post</div><div class="next_info"><span>알고리즘 문제 해결 스터디</span></div></a></div></nav><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> Comment</span></div><div id="disqus_thread"></div><script>var unused = null;
var disqus_config = function () {
  this.page.url = 'https://ch-4ml.github.io/posts/itv-hf-transaction/';
  this.page.identifier = 'posts/itv-hf-transaction/';
  this.page.title = 'itv-hf-transaction';
}
var d = document, s = d.createElement('script');
s.src = "https://" + 'ch-4ml' +".disqus.com/embed.js";
s.setAttribute('data-timestamp', '' + +new Date());
(d.head || d.body).appendChild(s);</script></div></div></div><footer><div id="footer"><div class="copyright">&copy;2019 By ch-4ml</div><div class="framework-info"><span>Driven </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="Read Mode"></i><i class="fa fa-plus" id="font_plus" title="Increase font size"></i><i class="fa fa-minus" id="font_minus" title="Decrease font size"></i><i class="nightshift fa fa-moon-o" id="nightshift" title="Dark Mode"></i></div><div id="rightside-config-show"><div id="rightside_config" title="Setting"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="Scroll to comment"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="Table of Contents" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="Back to top" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/nightshift.js"></script><script color="0,0,255" opacity="0.7" zIndex="-1" count="99" src="https://cdn.jsdelivr.net/gh/jerryc127/CDN/js/canvas-nest.js"></script><script src="/js/activate-power-mode.js"></script><script>POWERMODE.colorful = true; // make power mode colorful
POWERMODE.shake = true; // turn off shake
document.body.addEventListener('input', POWERMODE);
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script><script>const observer = lozad(); // lazy loads elements with default selector as '.lozad'
observer.observe();
</script></body></html>